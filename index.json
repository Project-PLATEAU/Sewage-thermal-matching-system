{
  "index.html": {
    "href": "index.html",
    "title": "下水熱ポテンシャルマッチングシステム",
    "keywords": "下水熱ポテンシャルマッチングシステム 3D都市モデルを活用した発電ポテンシャル推計・反射シミュレーションを行い、対象施設・適地の判定を行うためのシステムである。"
  },
  "manual/devMan.html": {
    "href": "manual/devMan.html",
    "title": "環境構築手順書",
    "keywords": "環境構築手順書 1 本書について 本書では、下水熱ポテンシャルマッチングシステム（以下「本システム」という。）の利用環境構築手順について記載しています。本システムの構成や仕様の詳細については以下も参考にしてください。 技術検証レポート 2 動作環境 本システムの動作環境は以下のとおりです。 項目 最小動作環境 推奨動作環境 OS Microsoft Windows 10 または 11 同左 CPU Intel Core i3以上 Intel Core i5以上 メモリ 8GB以上 32GB以上 ディスプレイ解像度 1024×768以上 1080ｐ ブラウザー Google Chrome バージョン 115 以降 Microsoft Edge バージョン 115 以降 Mozilla Firefox バージョン 117 以降 Mozilla Firefox バージョン 115 (ESR) Safari バージョン 16 以降 同左 ネットワーク ライセンス認証にネットワーク環境が必要 背景地図を表示させるために以下のURLを閲覧できる環境が必要 ・背景の標準地図 https://services.arcgisonline.com 同左 3 設定手順 3-1 インストール手順 ArcGIS Pro3.1.3のインストールを実施します。 こちら からアプリケーションをダウンロードします。 ダウンロード後、zipファイルを右クリックし、「即時解凍」を選択することで、zipファイルを展開します。 展開されたフォルダ内の「01_ArcGISProツールボックス」「02_ArcGISProアドイン」「03_ArcGISProプロジェクトテンプレート」を適切に配置・実行することで、アプリケーションが起動します。 「モジュール\\01_ArcGISProツールボックス\\SewerHeatGIS」フォルダを「C:\\」に 配置します。 ※配置後、「C:\\SewerHeatGIS\\ ArcGisPro」となることを確認してください。 「モジュール\\02_ArcGISProアドイン\\SewerHeatGIS_ProAppModule\\SewerHeatGIS_ProAppModule.esriAddinX」をダブルクリックして、 Esri ArcGIS アドイン インストール ユーティリティを起動します。 「アドインのインストール」ボタンをクリックします。 インストールが完了すると通知が表示されます。 「モジュール\\03_ArcGISProプロジェクト\\ArcGisPro」を任意のフォルダに配置してください。 3-2 Webの構築 ArcGIS OnlineおよびAzure App Serviceの契約が必要となります。 Azure Portalにアクセスし、「サインイン」からログインする。 [URL] https://azure.microsoft.com/ja-jp/get-started/azure-portal 「リソースの作成」をクリックする。 Webアプリの「作成」をクリックする。 「基本」画面で下記を参考に各情報を入力し、Windowsプランを「新規作成」する。 サブスクリプション ：デフォルト リソースグループ ：{任意} (リソースグループがなければ新規作成してください) 名前 ：{任意}※ https://{名前}.azurewebsites.netがWebのURLになります。 公開 ：コード ランタイム スタック ：.NET 6(LTS) オペレーティングシステム：Windows 地域 ：Japan West (またはJapan East) ※「新しいApp Serviceプラン」の名前は任意です。 価格プラン(Standard S1)を選択し、「次：データベース>」をクリックする。 データベースの作成はデフォルト(チェック無し)で、「次：デプロイ>」をクリックする。 全てデフォルトで「次：ネットワーク>」をクリックする。 全てデフォルトで「次：監視>」をクリックする。 Application Insightsを有効にする「いいえ」を選択し、「次：タグ>」をクリックする。 デフォルトで「次：確認および作成>」をクリックする。 内容を確認の上、「作成」ボタンをクリックする。 「デプロイが進行中です」のメッセージが「デプロイが完了しました」に変更となった ことを確認し、「リソースに移動」をクリックする。 左メニュー「デプロイセンター」をクリックする。 FTPS資格情報タブをクリックし、以下の情報を確認する。 FTPSエンドポイント：{自動生成} FTPSユーザー名：{自動生成} パスワード：{自動生成} 3-3 ArcGIS Onlineの初期設定 ・ArcGIS Onlineにアクセスし、「サインイン」からログインする。 [URL] https://www.arcgis.com/index.html ログイン後、画面上部の「コンテンツ」タブをクリックする。 「新しいアイテム」をクリックする。 「アプリケーション」をクリックする。 「Webマッピング」を選択し、URLにAzure App ServiceのURL(https://{名前}.azurewebsites.net)を入力して、「次へ」をクリックする。 各情報を入力し、「保存」をクリックする。 タイトル：{任意} (例) 下水熱UC フォルダ：{任意} (例) SewerHeatGIS タグ ：{任意} (例) production サマリー：{任意} (例) 下水熱UC公開用のアプリケーションキー アプリケーションキーの作成後、右上の「設定」ボタンをクリックする。 「信頼できるとしてマーク」をクリックする。 ※クリックすると自動で「削除の防止」がチェックされます。 画面下部の「目的」を「使用可能」に選択し、「アプリケーションの登録」をクリックする。 リダイレクトURL、URLには同様にAzure App ServiceのURL(https://{名前}.azurewebsites.net)を入力し、アプリケーション環境は「ブラウザー」を指定して、「登録」をクリックする。 以上の設定が完了すると以下の情報が発行されるので、手順4.2で利用する。 クライアントID：{自動生成} クライアントシークレット：{自動生成} 3-4 ArcGIS Onlineのアプリケーションキーを設定ファイルに反映 Webの設定ファイル「モジュール\\04_Web\\appsettings.Prod.json」をエディタで開く。 appsettings.Prod.json の\"appId\":に{クライアントID }を記載して保存する。 3-5 Azure App Serviceへのモジュールアップロード WinSCP 等のFTPクライアントツールを用意する。 WinSCPを起動して初期表示される設定画面で下記の項目を入力し、「設定」をクリック する。 転送プロトコル：FTP 暗号化 ：明示的な TLS/SSL 暗号化 ホスト名 ：{ FTPSエンドポイント} ポート番号 ：21 ユーザー名 ：{ FTPSユーザー名} 任意の「セッションの保存名」を入力して、「OK」をクリックする。 作成したセッション(下水熱UC公開サイト)を選択して、「ログイン」をクリックする。 パスワードを入力し、「OK」をクリックする。 ログイン完了後、左ペインのパスをダブルクリックする。 「参照」をクリックして、Web公開モジュールのフォルダを指定し、「開く」をクリックする。 ※「モジュール\\04_Web」を開く。 転送設定を「バイナリ」に指定し、左ペインの全フォルダ・全ファイルを全選択して、右ペインにドラッグ&ドロップする。 4 ビルド手順 自身でソースファイルをダウンロードしビルドを行うことで、実行ファイルを生成することができます。 ソースファイルは こちら からダウンロード可能です。 GitHubからダウンロードしたソースファイルの構成は以下のようになっています。 （1）本システムのソリューションファイル（SewerHeatGIS.sln）をVisualStudio2017以降のバージョンで開きます。 （2）SewerHeatGIS.slnをVisualStudio2017以降で開くと、ソリューション' SewerHeatGIS 'に3つのプロジェクトが表示されます。 以下の赤枠部分のように、ソリューション構成を【Release】に、ソリューションプラットフォームを【Any CPU】に設定します。 （3）以下の赤枠部分のように、[ソリューションのビルド]を選択し、ソリューション全体をビルドします。 （4）ビルドが正常に終了すると、ソリューションファイルと同じフォルダにあるbin\\Releaseフォルダに実行ファイルが生成されます。 ※ダウンロードしたソリューションをビルドする際に、ビルドエラーとなり、次のメッセージが出力されるケースがあります。 「（ファイル名）を処理できませんでした。インターネットまたは制限付きゾーン内にあるか、ファイルに Web のマークがあるためです。これらのファイルを処理するには、Web のマークを削除してください。」 この場合は該当するファイルのプロパティを開き、全般タブ内の「セキュリティ」の項目について[許可する]にチェックを入れてください。 【参考】 ソースファイルの構成と機能は以下のようになっています。コードを修正する際の参考としてください。 ・システムのディレクトリ構成(ArcGIS Pro) ・システムのディレクトリ構成(Web) 5 準備物一覧 アプリケーションを利用するために以下のデータを入手します。 データ種別 機能 用途 入力方法 ① 3D都市モデル(CityGML)G空間情報センターから取得します。 https://front.geospatial.jp/ 全般 全般 格納フォルダパス指定 ② 下水道データ（SewerPipe及びManhole） 全般 全般 格納フォルダパス指定 本システムでは、3D都市モデルの建築物モデルの形状（LOD0、LOD1）と属性を活用します。 地物 地物型 属性区分 属性名 内容 建築物 bldg:lod1Solid 空間属性 bldg:lod1Solid 建築物のLOD1の立体 主題属性 uro_buildingDetails_totalFloorArea 延床面積：m2 bldg_storeysAboveGround 地上階数 bldg_storeysBelowGround 地下階数 bldg_measuredHeight 計測高さ：m bldg_usage 建物用途 bldg:lod0FootPrint FootPrint1 uro_buildingDetails_buildingFootprintArea FootPrint2 Shape_Area ShapeArea FootPrint 図形面積：m2 gen_建物ID gen_建物ID HeatDemand1 熱需要値(冷房)：MJ/年 HeatDemand2 熱需要値(暖房)：MJ/年 HeatDemand3 熱需要値(空調)：MJ/年 HeatDemand4 熱需要値(給湯)：MJ/年 KankyoKey 管渠キー NewYouto 統合した建物用途 Nobeyuka 延床面積格納：m2 tmpKankyoKey 関連管渠キー（修正） ReHeatDem3 正確な熱需要格納（空調）：MJ/年 ReHeatDem4 正確な熱需要格納（給湯）：MJ/年 TR_AREA 処理区 管渠 uro:SewerPipe 空間属性 frn:lod2Geometry 管渠図形 主題属性 gml:description 説明 core:creationDate データ作成日 frn:function 機能 uro:cityFurnitureDataQualityAttribute データ品質属性 uro:geometrySrcDesc 幾何属性作成方法 uro:frnFacilityIdAttribute.uro:FacilityIdAttribute 施設識別属性 uro:id 識別子 uro:prefecture 都道府県 uro:city 市区町村 uro:alternativeName その他の名称 uro:dmCode DMコード uro:geometryType レコードタイプ uro:mapLevel 地図情報レベル uro:shapeType 図形区分 uro:lod0Geometry 図式情報 uro:occupierType 事業者区分 uro:year 埋設年度 uro:yearType 確からしさ uro:administrator 主管事業者 uro:startNode 開始ノード uro:endNode 終了ノード uro:depth 深さ uro:minDepth 最小深さ uro:maxDepth 最大深さ uro:material 管渠材質の種類 uro:lengthAttribute 長さ uro:length 延長 uro:innerDiamiter 内径 uro:outerDiamiter 外径 SEQNO ユニークキー U_MNSEQ 上流人孔キー L_MNSEQ 下流人孔キー MATERIAL 管種 SEC_DIST 区間距離：m DIAMETER 口径：mm DIAMETER_W 口径（幅）：mm DIAMETER_H 口径（高）：mm THICKNESS 管厚：mm GAIKEI_W 外径（幅）：mm GAIKEI_H 外径（高）：mm U_BTM_HI 上流管底高：m L_BTM_HI 下流管底高：m U_CNT_HI 上流管心高：m L_CNT_HI 下流管心高：m A_COVERING 平均土被り：m U_COVERING 上流土被り：m L_COVERING 下流土被り：m CONST_YEAR 施工年度 TR_AREA 処理区 TeikaYuka 逓加延床面積：m2 NobeyukaSum 接続延床面積：m2 SewerFlow_S 推定下水流量（夏）：m3/日 SewerFlow_W 推定下水流量（冬）：m3/日 SewerFlow_Y 推定下水流量（年間）：m3/日 Potential_S ポテンシャル値（夏）：MJ/日 Potential_W ポテンシャル値（冬）：MJ/日 マンホール uro:Manhole 空間属性 frn:lod2Geometry マンホール図形 主題属性 gml:description 説明 core:creationDate データ作成日 gen:measureAttribute 汎用属性（単位付き計測値） gen:genericAttributeSet 汎用属性セット frn:function 機能 uro:cityFurnitureDataQualityAttribute データ品質属性 uro:geometrySrcDesc 幾何属性作成方法 uro:frnFacilityIdAttribute.uro:FacilityIdAttribute 施設識別属性 uro:id 識別子 uro:prefecture 都道府県 uro:city 都道府県 uro:alternativeName その他の名称 uro:frnDmAttribute.DmGeometricAttribute 図式情報 uro:dmCode DMコード uro:geometryType レコードタイプ uro:mapLevel 地図情報レベル uro:shapeType 図形区分 uro:lod0Geometry 図式情報 uro:occupierType 事業者区分 uro:year 埋設年度 uro:yearType 確からしさ uro:administrator 主管事業者 uro:containerType 構造物の種類 uro:innerDiamiterLong 長辺の内径 uro:outerDiamiterLong 長辺の外径 uro:innerDiamiterShort 短辺の内径 uro:outerDiamiterShort 短辺の外径 uro:depth 深さ ANGLE 角度 SEQNO ユニークキー FCLASS 分類 I_DIAMETER 内径：mm DIAMETER_L 長辺内径：mm GAIKEI_L 長辺外径：mm DIAMETER_S 短辺内径：mm GAIKEI_S 短辺外径：mm GROUND_HI 地盤高：m DEPTH 深さ：m TR_AREA 処理区 Potential_S ポテンシャル値（夏）：MJ/日 Potential_W ポテンシャル値（冬）：MJ/日 Potential_Y ポテンシャル値（年間）：MJ/年"
  },
  "manual/userMan.html": {
    "href": "manual/userMan.html",
    "title": "操作マニュアル",
    "keywords": "操作マニュアル 1 本書について 本書では、下水熱ポテンシャルマッチングシステム（以下「本システム」という。）の操作手順について記載しています。 2 使い方 2-1 トップ画面 本システムは「ポテンシャルマップ作成ツール」と「下水熱ツール」の２種類で構成されています。ポテンシャルマップ作成ツールは、設定ファイル「SewerHeatGIS.aprx」を起動すると以下の画面が表示されます。 ① 下水熱設定ツール 建物用途の変換、熱需要算出処理、最寄り管渠検索を実行します。 ② 延床面積集計 管渠を選択することで、選択された管渠の逓加延床面積を集計します。 ③ ポテンシャル計算 管渠の熱ポテンシャルを計算します。 下水熱ツールは、URLにてログインすると以下の画面が表示されます。 ① 拡大・縮小・２Dと３D表示の切り替え 画面の拡大・縮小及び２Dと３Dの切り替えを行えます。 ② 凡例 画面上に表示されている図形の凡例を表示します。 ③ 下水熱ツール 下水熱ツールで利用可能な各種機能が表示されます。 2-2 ポテンシャルマップ作成ツール ポテンシャルマップ作成ツールの①～③を押下することで、各種処理を実行することができます。 2-2-1 下水熱設定ツール ① 設定ファイル選択 ・「選択」ボタンを押下するとファイル/フォルダ選択のダイアログが表示され、ダイアログの中で選択したパスがテキストボックスに入力されます。 ② 建物用途変換ファイル選択 ・「選択」ボタンを押下するとファイル/フォルダ選択のダイアログが表示され、ダイアログの中で選択したパスがテキストボックスに入力されます。 ③ 熱需要算出処理実行 ・①及び②で設定ファイル選択を行ったうえで「熱需要算出処理実行」ボタンを押下すると、各建物に対して熱受領を算出する処理が実行されます。 ④ 最寄り管渠検索処理方法 ・建物に対する最寄り建物の検索方法を「建物からの距離で管渠を検索」「建物からの距離で桝を検索」の２種類から選択できます。 ⑤ 最寄り管渠検索処理実行 ・④で選択した方法で各建物に対する最寄り管渠を検索します。 ⑥ 終了 ・ダイアログを閉じます。 2-2-2 延床面積集計 ① 設定ファイル選択 ・「選択」ボタンを押下するとファイル/フォルダ選択のダイアログが表示され、ダイアログの中で選択したパスがテキストボックスに入力されます。 ② 上流側延べ床面積１ ・延べ床面積を集計する対象管渠の上流側に合流してくる管渠の延べ床面積を入力することで、入力した数値を初期値として延べ床面積の集計を実行できます。（②～⑤までの４種類の合計を初期値に設定できる） ③ 上流側延べ床面積２ ・延べ床面積を集計する対象管渠の上流側に合流してくる管渠の延べ床面積を入力することで、入力した数値を初期値として延べ床面積の集計を実行できます。（②～⑤までの４種類の合計を初期値に設定できる） ④ 上流側延べ床面積３ ・延べ床面積を集計する対象管渠の上流側に合流してくる管渠の延べ床面積を入力することで、入力した数値を初期値として延べ床面積の集計を実行できます。（②～⑤までの４種類の合計を初期値に設定できる） ⑤ 上流側延べ床面積４ ・延べ床面積を集計する対象管渠の上流側に合流してくる管渠の延べ床面積を入力することで、入力した数値を初期値として延べ床面積の集計を実行できます。（②～⑤までの４種類の合計を初期値に設定できる） ⑥ 上流延床面積値初期化 ・②～⑤に入力されている値を初期化（０に戻す）します。 ⑦ 管渠選択 ・②～⑤に入力されている値の合計を初期値として、選択した管渠から下流の管渠追跡を行い、延床面積を集計します。（管渠が分岐するか合流するまで追跡を実施し、延床面積を集計します） ⑧ 終了 ・ダイアログを閉じます。 2-2-3 ポテンシャル計算 ① 設定ファイル選択 ・「選択」ボタンを押下するとファイル/フォルダ選択のダイアログが表示され、ダイアログの中で選択したパスがテキストボックスに入力されます。 ② ポテンシャル計算実行 ・各管渠に対する熱ポテンシャル値を計算します。 ③ 終了 ・ダイアログを閉じます。 2-3 下水熱ツール 下水熱ツールの②～⑯を押下することで、各種処理を実行することができます。 ① 処理の流れ ・下水熱ツールで実施できる処理の流れを示しています。 ② 地区絞込み（処理区） ・ここで選択した処理区内の建物、管渠、人孔だけが表示されます。 ③ 検索対象選択 ・下水熱を検討する対象を「空調」「給湯」から選択します。 ④ 検索バッファー指定 ・熱需給マッチングのうち、家屋から選択される管渠の最大バッファー値を指定できます。（最大値は150mまで） ⑤ 熱需給マッチング（家屋（1件）→管渠選択） ・ボタンを押下し、画面上で家屋を１件選択すると、家屋の熱需要値より高い熱ポテンシャル値を持ち、且つ家屋から④で指定した距離内にある管渠が強調表示されます。 ⑥ 熱需給マッチング（管渠（複数可）→家屋選択） ・ボタンを押下し、画面上で管渠（複数可）を選択すると、管渠の熱ポテンシャル値より低い熱需要値を持つ家屋が強調表示されます。 ⑦ 検索バッファー指定 ・熱需給マッチングのうち、人孔から選択される家屋の最大バッファー値を指定できます。（最大値は150mまで） ⑧ 熱需給マッチング（人孔（１件）→家屋選択→管渠（複数可）絞込） ・ボタンを押下し、画面上で人孔を１件選択し絞込用管渠をすることで、人孔の熱ポテンシャル値より低い熱需要値を持ち、且つ人孔から⑦で指定した距離内にあり、選択した管渠に関連付いている家屋が強調表示されます。 ⑨ 熱需要値変更 ・ボタンを押下し、画面上で家屋を１件選択すると、⑰が表示されここで年間のエネルギー量を入力することで正確な熱需要値が家屋の熱需要値に入力される。 ⑩ 関連管渠変更 ・ボタンを押下し、画面上で家屋→管渠の順で選択することで家屋に関連付く管渠が変更される。 ⑪ 家屋→管渠（シミュレーション対象）選択 ・ボタンを押下し、画面上で家屋→管渠の順で選択することでシミュレーション対象を指定する。このボタンで対象を選択するまで、⑫～⑯はグレーアウトしている。 ⑫ ヒートポンプ配置 ・ボタンを押下すると、画面が３Dに切り替わり選択された家屋の熱需要値と管渠の熱ポテンシャル値で必要となるヒートポンプの大きさと同等の立体が表示される。画面上でヒートポンプを移動・回転させ設置する場所を確定後、画面右上に表示される「配置決定」を押下することでヒートポンプの設置場所を確定できる。 ⑬ 採熱経路作成 ・ヒートポンプから採熱対象となる人孔までの経路を画面上で入力し、採熱経路を確定させる。 ⑭ 検討ツール作成 ・選択した家屋、管渠、作成したヒートポンプ、採熱経路、③で選択した検討対象などより「下水熱利用可能性簡易検討ツール」に数値を入力した結果のExcelを圧縮（ZIP形式）したデータをダウンロードできる。 ⑮ 調書作成 ・選択した家屋、管渠の各種情報や検討した位置画像挿入した「下水熱利用調書」をPDF形式でダウンロードできる。 ⑯ 初期化 ・選択した家屋、管渠、作成したヒートポンプ、採熱経路の初期化を行います。 ⑰ 熱需要換算値入力画面 ・正しい熱需要を入力する際に、各値を入力すると熱需要に換算し家屋の属性に格納できる。 3 出力データ 解析・シミュレーション機能で出力されるデータは以下のとおりです。 機能 出力データ 内容 データ形式 検討ツール作成 下水熱利用可能性簡易検討ツール 選択した家屋、管渠、作成したヒートポンプ、採熱経路、選択した検討対象などを「下水熱利用可能性簡易検討ツール」に入力したデータ Microsoft Excelを圧縮したZIP 調書作成 下水熱利用調書 選択した家屋、管渠の各種情報や検討した位置画像などを用いて作成した調書データ PDF 3-1 下水熱利用可能性簡易検討ツール 本システムでは、検討ツール作成機能から国土交通省 水管理・国土保全局下水道部作成の下水熱利用可能性簡易検討ツールに必要となる値を入力した状態でダウンロードできます。 3-2 下水熱利用調書 選択した家屋の情報、選択した管渠の情報、ヒートポンプのサイズ、採熱経路計画位置図を記載した調書がPDF形式で出力されます。"
  }
}